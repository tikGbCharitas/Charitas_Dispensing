@*     @model IEnumerable<MultiBatchItemBin>

@if (User.FindFirst(ClaimTypesCustom.CRUD)?.Value == "true")
{
    <div class="alert alert-danger text-center alert-viewbag-error" role="alert">
        Save Function is disable, any change won't affect database
    </div>
}

<!-- Floating Button Trigger -->
<div id="camera-float-button" class="camera-draggable shadow rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
     style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 60px; height: 60px; z-index: 1055; cursor: grab;"
     onclick="OpenCloseCamera()">
    📷
</div>

<!-- Camera Container -->
<div id="qr-reader-container" class="camera-draggable shadow p-2 bg-light rounded"
     style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                width: 90%; max-width: 500px; z-index: 1050; display: none;">
    <div id="qr-reader" style="width: 100%; min-height: 50px"></div>
</div>

<div class="row mb-3">
    <div class="row align-items-center">
        <label for="inputRegNo" class="col-sm-4 col-form-label fw-bold">Registration No.</label>
        <div class="col-sm-8">
            <input id="inputRegNo" type="text" class="form-control" />
        </div>
    </div>
</div>

<div class="d-flex justify-content-center">
    <button class="btn btn-primary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDetail" aria-expanded="false" aria-controls="collapseDetail">
        Show / Hide Detail
    </button>
</div>

<div class="collapse" id="collapseDetail">
    <div id="binList" class="mb-4">
        @if (Model.Any())
        {
            <div class="mb-3 d-flex align-items-center">
                <label for="SelectedBin" class="form-label fw-bold me-2 mb-0">Bin:</label>
                <input id="SelectedBin" type="text" class="form-control" readonly />
            </div>

            <div class="row g-2">
                @foreach (var item in Model)
                {
                    <div class="col-6 col-sm-4 col-md-3">
                        <button id="btnbinList-@item.BinID"
                                type="button"
                                class="btn btn-outline-primary w-100 py-2"
                                value="@item.BinName"
                                data-bin-id="@item.BinID">
                            @item.BinName
                        </button>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="alert alert-info text-center">
                No Item.
            </div>
        }
    </div>

    <div id="SelectedEDBatch" class="p-3">
        <div class="row g-3">
            <!-- ItemID -->
            <div class="col-md-6">
                <div class="row align-items-center">
                    <label for="inputItemID" class="col-sm-4 col-form-label fw-bold">Item</label>
                    <div class="col-sm-8">
                        <input id="inputItemID" type="text" class="form-control" readonly />
                    </div>
                </div>
            </div>
            <!-- BPOM -->
            <div class="col-md-6">
                <div class="row align-items-center">
                    <label for="inputNIEBPOM" class="col-sm-4 col-form-label fw-bold">BPOM</label>
                    <div class="col-sm-8">
                        <input id="inputNIEBPOM" type="text" class="form-control" readonly />
                    </div>
                </div>
            </div>
            <!-- Batch -->
            <div class="col-md-6">
                <div class="row align-items-center">
                    <label for="inputBatch" class="col-sm-4 col-form-label fw-bold">Batch</label>
                    <div class="col-sm-8">
                        <input id="inputBatch" type="text" class="form-control" readonly />
                    </div>
                </div>
            </div>
            <!-- Expired Date -->
            <div class="col-md-6">
                <div class="row align-items-center">
                    <label for="inputExpiredDate" class="col-sm-4 col-form-label fw-bold">Expired Date</label>
                    <div class="col-sm-8">
                        <input id="inputExpiredDate" type="text" class="form-control" readonly />
                    </div>
                </div>
            </div>
            <!-- Quantity -->
            <div class="col-md-6">
                <div class="row align-items-center">
                    <label for="inputQuantity" class="col-sm-4 col-form-label fw-bold">Quantity</label>
                    <div class="col-sm-8">
                        <input id="inputQuantity" type="number" min="0" class="form-control" />
                    </div>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-between flex-wrap mt-4">
            <button class="btn btn-secondary px-4 py-2 shadow-sm" id="btnChooseEDBatchManually">
                📋 Choose Manual
            </button>
            <button class="btn btn-success px-4 py-2 shadow-sm" id="btnAddToList">
                Add
            </button>
        </div>
    </div>
</div>

<div class="d-flex justify-content-center">
    <button class="btn btn-primary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseItemList" aria-expanded="false" aria-controls="collapseItemList">
        📦 Show / Hide Item List
    </button>
</div>

<div class="collapse" id="collapseItemList">
    <div id="NoItemList">
        <div class="alert alert-info text-center">
            No Item.
        </div>
    </div>
    <div id="itemList">
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4">
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ModalChooseEDBatchManually" tabindex="-1" aria-labelledby="manualModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content shadow-lg">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="manualModalLabel">Choose Item Manually</h5>
                <button type="button" class="btn-close btn-close-white closeModal"></button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary closeModal">Close</button>
                <button class="btn btn-success savedModal">Save</button>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        var getBinItemUrl = '@Url.Action("GetBinItem", "ServiceUnitTransactionEntry")';
        var getRegNoUrl = '@Url.Action("GetRegNo", "ServiceUnitTransactionEntry")';
    </script>
    <script src="@Url.Content("~/js/Pages/ServiceUnitTransactionEntry.js")"></script>
    <script src="@Url.Content("~/lib/html5-qrcode-master/html5-qrcode.min.js")"></script>
} *@

@model IEnumerable<MultiBatchItemBin>
@{
    ViewData["Title"] = "SUTE";
    var CommonLocalizer = Factory.Create("Views.Shared.Common", Assembly.GetExecutingAssembly().GetName().Name!);
}

<!-- Floating Camera Button -->
<div id="camera-float-button"
     class="camera-draggable shadow rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
     style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 60px; height: 60px; z-index: 1055; cursor: grab;"
     onclick="OpenCloseCamera()">
    📷
</div>

<!-- Camera Container -->
<div id="qr-reader-container"
     class="camera-draggable shadow p-2 bg-light rounded"
     style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 500px; z-index: 1050; display: none;">
    <div id="qr-reader" style="width: 100%; min-height: 50px"></div>
</div>

<div class="alert alert-danger text-center alert-viewbag-error m-3" role="alert">
    @CommonLocalizer["OnDevelopment"]
</div>

<div class="container-fluid">
    <div class="row g-4">

        <!-- Patient Detail -->
        <div class="col-12">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-info text-white fw-bold"
                     role="button"
                     data-bs-toggle="collapse"
                     data-bs-target="#collapsePatientDetail"
                     aria-expanded="true"
                     aria-controls="collapsePatientDetail">
                    🧑‍⚕️ Patient Detail
                </div>
                <div id="collapsePatientDetail" class="collapse show">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="mb-3 col-md-6">
                                <label for="inputRegNo" class="form-label fw-bold">Registration No.</label>
                                <input id="inputRegNo" type="text" class="form-control" />
                            </div>
                            <div class="mb-3 col-md-6">
                                <label for="inputPatientName" class="form-label fw-bold">Patient Name</label>
                                <input id="inputPatientName" type="text" class="form-control" readonly />
                            </div>
                            <div class="mb-3 col-md-6">
                                <label for="inputMedicalNo" class="form-label fw-bold">Medical No</label>
                                <input id="inputMedicalNo" type="text" class="form-control" readonly />
                            </div>
                            <div class="mb-3 col-md-6">
                                <label for="inputParamedicName" class="form-label fw-bold">Paramedic</label>
                                <input id="inputParamedicName" type="text" class="form-control" readonly />
                            </div>
                            <div class="d-flex justify-content-center">
                                <button class="btn btn-success px-4 py-2 shadow-sm" id="btnTest" onclick="CheckRegNo('REG/OP/250813-0001')">Test</button>
                            </div>
                        </div>                        
                    </div>
                </div>
            </div>
        </div>

        <!-- Bin List -->
        <div class="col-12">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white fw-bold"
                     role="button"
                     data-bs-toggle="collapse"
                     data-bs-target="#collapseBinList"
                     aria-expanded="true"
                     aria-controls="collapseBinList">
                    🗃️ Bin List
                </div>
                <div id="collapseBinList" class="collapse show">
                    <div class="card-body">
                        @if (Model.Any())
                        {
                            <div class="mb-3">
                                <label for="SelectedBin" class="form-label fw-bold">Selected Bin</label>
                                <input id="SelectedBin" type="text" class="form-control" readonly />
                            </div>

                            <div class="row g-2">
                                @foreach (var item in Model)
                                {
                                    <div class="col-6 col-sm-4">
                                        <button id="btnbinList-@item.BinID"
                                                type="button"
                                                class="btn btn-outline-primary w-100 py-2"
                                                value="@item.BinName"
                                                data-bin-id="@item.BinID">
                                            @item.BinName
                                        </button>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-info text-center">No Bin Available.</div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Item Detail -->
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-warning fw-bold"
                     role="button"
                     data-bs-toggle="collapse"
                     data-bs-target="#collapseItemDetail"
                     aria-expanded="true"
                     aria-controls="collapseItemDetail">
                    📦 Item Detail
                </div>
                <div id="collapseItemDetail" class="collapse show">
                    <div class="card-body">
                        <!-- isi form item detail -->
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="inputItemID" class="form-label fw-bold">Item</label>
                                <input id="inputItemID" type="text" class="form-control" readonly />
                            </div>
                            <div class="col-md-6">
                                <label for="inputNIEBPOM" class="form-label fw-bold">BPOM</label>
                                <input id="inputNIEBPOM" type="text" class="form-control" readonly />
                            </div>
                            <div class="col-md-6">
                                <label for="inputBatch" class="form-label fw-bold">Batch</label>
                                <input id="inputBatch" type="text" class="form-control" readonly />
                            </div>
                            <div class="col-md-6">
                                <label for="inputExpiredDate" class="form-label fw-bold">Expired Date</label>
                                <input id="inputExpiredDate" type="text" class="form-control" readonly />
                            </div>
                            <div class="col-md-6">
                                <label for="inputQuantity" class="form-label fw-bold">Quantity</label>
                                <input id="inputQuantity" type="number" min="0" class="form-control" />
                            </div>
                        </div>
                        <div class="d-flex justify-content-between flex-wrap mt-4">
                            <button class="btn btn-secondary px-4 py-2 shadow-sm" id="btnChooseEDBatchManually">📋 Choose Manual</button>
                            <button class="btn btn-success px-4 py-2 shadow-sm" id="btnAddToList">Add</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Item List -->
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white fw-bold"
                     role="button"
                     data-bs-toggle="collapse"
                     data-bs-target="#collapseItemListCard"
                     aria-expanded="true"
                     aria-controls="collapseItemListCard">
                    📑 Item List
                </div>
                <div id="collapseItemListCard" class="collapse show">
                    <div class="card-body">
                        <div id="NoItemList" class="alert alert-info text-center">No Item.</div>
                        <div id="itemList">
                            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ModalChooseEDBatchManually" tabindex="-1" aria-labelledby="manualModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content shadow-lg">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="manualModalLabel">Choose Item Manually</h5>
                <button type="button" class="btn-close btn-close-white closeModal"></button>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary closeModal">Close</button>
                <button class="btn btn-success savedModal">Save</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        var getBinItemUrl = '@Url.Action("GetBinItem", "ServiceUnitTransactionEntry")';
        var getRegNoUrl = '@Url.Action("GetRegNo", "ServiceUnitTransactionEntry")';
    </script>
    <script src="@Url.Content("~/js/Pages/ServiceUnitTransactionEntry.js")"></script>
    <script src="@Url.Content("~/lib/html5-qrcode-master/html5-qrcode.min.js")"></script>
}
    